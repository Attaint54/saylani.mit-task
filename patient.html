<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description"
        content="MedVault Patient Portal ‚Äî View profile, appointment history, prescriptions, and download PDFs." />
    <title>MedVault ‚Äî Patient Portal</title>
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/patient.css" />
</head>

<body>
    <div class="dashboard-layout">
        <!-- ====== SIDEBAR ====== -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">üè•</div>
                <span class="sidebar-brand">MedVault</span>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-section-title">My Portal</div>
                <a class="nav-item active" onclick="switchPage('profile', this)">
                    <span class="nav-icon">üë§</span> My Profile
                </a>
                <a class="nav-item" onclick="switchPage('appointments', this)">
                    <span class="nav-icon">üìÖ</span> Appointments
                </a>
                <a class="nav-item" onclick="switchPage('prescriptions', this)">
                    <span class="nav-icon">üíä</span> Prescriptions
                </a>
                <a class="nav-item" onclick="switchPage('history', this)">
                    <span class="nav-icon">üìã</span> Medical History
                </a>
            </nav>
            <div class="sidebar-footer">
                <a class="nav-item" onclick="logoutUser()" style="color:var(--danger)">
                    <span class="nav-icon">üö™</span> Logout
                </a>
            </div>
        </aside>

        <!-- ====== MAIN CONTENT ====== -->
        <main class="main-content">
            <header class="topbar">
                <div class="topbar-left">
                    <button class="btn btn-icon mobile-menu-btn" onclick="toggleSidebar()">‚ò∞</button>
                    <h1 class="topbar-title" id="page-title">My Profile</h1>
                </div>
                <div class="topbar-right">
                    <span class="topbar-user-name" id="pt-name">Patient</span>
                    <div class="topbar-avatar" id="pt-avatar">P</div>
                </div>
            </header>

            <!-- ====== PAGE: PROFILE ====== -->
            <div class="page-content page-section active" id="page-profile">
                <div class="glass-card profile-card fade-in" id="profile-card">
                    <div class="profile-avatar" id="profile-avatar">P</div>
                    <div class="profile-info">
                        <div style="display:flex;justify-content:space-between;align-items:start">
                            <div>
                                <h2 id="profile-name">‚Äî</h2>
                                <p id="profile-email">‚Äî</p>
                            </div>
                            <button class="btn btn-secondary btn-sm" onclick="openEditProfileModal()">Edit
                                Profile</button>
                        </div>
                        <div class="profile-meta">
                            <div class="meta-item"><small>Age</small><span id="profile-age">‚Äî</span></div>
                            <div class="meta-item"><small>Gender</small><span id="profile-gender">‚Äî</span></div>
                            <div class="meta-item"><small>Contact</small><span id="profile-contact">‚Äî</span></div>
                            <div class="meta-item"><small>Member Since</small><span id="profile-joined">‚Äî</span></div>
                        </div>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="grid grid-3 mt-lg">
                    <div class="glass-card stat-card fade-in">
                        <div class="stat-icon" style="background:rgba(251,191,36,0.15);color:var(--warning)">üìÖ</div>
                        <div class="stat-value" id="stat-appts">0</div>
                        <div class="stat-label">Total Appointments</div>
                    </div>
                    <div class="glass-card stat-card fade-in">
                        <div class="stat-icon" style="background:rgba(52,211,153,0.15);color:var(--success)">üíä</div>
                        <div class="stat-value" id="stat-rx">0</div>
                        <div class="stat-label">Prescriptions</div>
                    </div>
                    <div class="glass-card stat-card fade-in">
                        <div class="stat-icon" style="background:rgba(96,165,250,0.15);color:var(--info)">ü©∫</div>
                        <div class="stat-value" id="stat-next">‚Äî</div>
                        <div class="stat-label">Next Appointment</div>
                    </div>
                </div>
            </div>

            <!-- ====== PAGE: APPOINTMENTS ====== -->
            <div class="page-content page-section" id="page-appointments" style="display:none">
                <div class="glass-card fade-in">
                    <div class="section-header">
                        <h3>My Appointments</h3>
                        <button class="btn btn-primary" onclick="openBookingModal()">üìÖ Book Appointment</button>
                    </div>
                    <div id="patient-appointments">
                        <div class="empty-state">
                            <div class="spinner" style="margin:0 auto"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ====== BOOKING MODAL ====== -->
            <div class="modal-overlay" id="booking-modal">
                <div class="modal">
                    <div class="modal-header">
                        <h3>üìÖ Book Appointment</h3>
                        <button class="modal-close" onclick="closeBookingModal()">‚úï</button>
                    </div>
                    <form id="booking-form" onsubmit="handleBookAppointment(event)">
                        <div class="form-group">
                            <label for="book-doctor">Select Doctor</label>
                            <select id="book-doctor" class="form-input form-select" required>
                                <option value="">‚Äî Choose a doctor ‚Äî</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="book-date">Appointment Date</label>
                            <input type="date" id="book-date" class="form-input" required />
                        </div>
                        <div class="form-group">
                            <label for="book-time">Preferred Time</label>
                            <input type="time" id="book-time" class="form-input" required />
                        </div>
                        <div class="form-group">
                            <label for="book-reason">Reason for Visit</label>
                            <textarea id="book-reason" class="form-input form-textarea"
                                placeholder="Describe your symptoms or reason..." rows="3"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary btn-lg" id="book-btn"
                            style="width:100%;justify-content:center;margin-top:var(--spacing-md)">
                            Confirm Appointment
                        </button>
                    </form>
                </div>
            </div>

            <!-- ====== EDIT PROFILE MODAL ====== -->
            <div class="modal-overlay" id="edit-profile-modal">
                <div class="modal">
                    <div class="modal-header">
                        <h3>‚úèÔ∏è Edit Profile</h3>
                        <button class="modal-close" onclick="closeModal('edit-profile-modal')">‚úï</button>
                    </div>
                    <form id="edit-profile-form" onsubmit="handleEditProfile(event)">
                        <div class="form-group">
                            <label for="edit-profile-age">Age</label>
                            <input type="number" id="edit-profile-age" class="form-input" required min="1" max="150" />
                        </div>
                        <div class="form-group">
                            <label for="edit-profile-gender">Gender</label>
                            <select id="edit-profile-gender" class="form-input form-select" required>
                                <option value="" disabled>Select Gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="edit-profile-contact">Contact Number</label>
                            <input type="tel" id="edit-profile-contact" class="form-input" required />
                        </div>
                        <button type="submit" class="btn btn-primary btn-lg" id="edit-profile-btn"
                            style="width:100%;justify-content:center;margin-top:var(--spacing-md)">
                            Save Changes
                        </button>
                    </form>
                </div>
            </div>

            <!-- ====== PAGE: PRESCRIPTIONS ====== -->
            <div class="page-content page-section" id="page-prescriptions" style="display:none">
                <div id="patient-prescriptions">
                    <div class="empty-state">
                        <div class="spinner" style="margin:0 auto"></div>
                    </div>
                </div>
            </div>

            <!-- ====== PAGE: MEDICAL HISTORY ====== -->
            <div class="page-content page-section" id="page-history" style="display:none">
                <div class="glass-card fade-in">
                    <h3 style="margin-bottom:var(--spacing-lg)">Medical History Timeline</h3>
                    <div class="timeline" id="medical-timeline" style="padding-left:28px;position:relative">
                        <div class="empty-state">
                            <div class="spinner" style="margin:0 auto"></div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
    <!-- jsPDF for PDF download -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="js/firebase-config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/patient.js"></script>
</body>

</html>